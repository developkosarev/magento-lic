!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery"),require("mage/translate")):"function"==typeof define&&define.amd?define(["jquery","mage/translate"],e):"object"==typeof exports?exports["magesuite-store-locator"]=e(require("jquery"),require("mage/translate")):t["magesuite-store-locator"]=e(t.jquery,t["mage/translate"])}(window,(function(t,e){return function(t){var e={};function o(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(s,r,function(e){return t[e]}.bind(null,r));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=239)}({0:function(e,o){e.exports=t},239:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(240)},240:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(241)},241:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(242);var s=o(243),r=o(0);r(".cs-store-locator").length&&new s.default(r(".cs-store-locator"))},242:function(t,e,o){"use strict";o.r(e)},243:function(t,e,o){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,o=1,s=arguments.length;o<s;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=o(0);o(3);var i=o(244),n=o(245),a=function(){function t(t,e){var o=this;this._options={mapOptions:{zoom:7,center:{lat:51,lng:9},mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1},basicZoom:13,basicZoomSmallDesktop:12,basicZoomMobile:12,useDefaultMapStyles:!1,markerIcons:{pin:{sizes:{x:18,y:25}},pinAlt:{sizes:{x:18,y:25}},pinActive:{sizes:{x:18,y:25}},userLocation:{sizes:{x:25,y:25}}},clusterStyles:{url:"",height:22,width:22,textSize:12,textColor:"#fff",backgroundPosition:"center"},limitOfShopsInitiallyDisplayed:50,storeData:"\n            name\n            latitude\n            longitude\n            city\n            street\n            postCode\n            description\n            sourceCode\n            countryId\n            phone\n            fax\n            email\n            url\n        "},this.stores=[],this._allItemsRendered=!1,this._$element=t||r(".cs-store-locator"),this._options=r.extend(!0,this._options,e),this._$sidebarToggler=this._$element.find(".cs-store-locator__sidebar-toggler"),this._$locationButton=this._$element.find(".cs-store-locator__location-button"),this._$searchButton=this._$element.find(".cs-store-locator__search-button"),this._$searchForm=this._$element.find(".cs-store-locator__search-form"),this._$searchInput=this._$element.find(".cs-store-locator__search-input"),this._$itemsList=this._$element.find(".cs-store-locator__stores-list-inner"),this._basePath=this._$element.attr("data-base-path"),this._options.useDefaultMapStyles||(this._options.mapOptions.styles=i.default),this._$element.addClass("loading"),this.map=new google.maps.Map(document.getElementById("store-locator-map"),this._options.mapOptions),r.post({url:this._basePath+"graphql",data:JSON.stringify({query:"{\n                    storePickupLocations {\n                      items {\n                        "+this._options.storeData+"\n                      }\n                    }\n                  }"}),contentType:"application/json"}).done((function(t){t.data&&(o.stores=t.data.storePickupLocations.items),o._$element.removeClass("loading"),o._initMap()})),this._attachEvents()}return t.prototype.searchButtonClickHandler=function(){var t=this,e=r(".cs-store-locator__search-input").val();this._$searchForm.addClass("loading"),this.getCoordinatesFromQuery(e).then((function(e){if(e.data.addressLocation&&e.data.addressLocation.latitude&&e.data.addressLocation.longitude){var o={lat:e.data.addressLocation.latitude,lng:e.data.addressLocation.longitude};t.map.panTo(o);var s=r(window).width();if(s<breakpoint.laptop?t.map.setZoom(11):s>=breakpoint.laptop&&s<breakpoint.laptopLg?t.map.setZoom(t._options.basicZoomSmallDesktop):t.map.setZoom(t._options.basicZoom),o===t._userPosition)return;t.setUserPositionAndPopulateDistance(t.stores,o),r(window).width()<breakpoint.laptop?t.renderMobileStoresList():t.renderItems(t.getFilteredStores(),!1),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:o,map:t.map,icon:t._options.markerIcons.userLocation})}else r(".cs-store-locator__empty-message--nolocation").remove(),t._$itemsList.prepend('<div class="cs-store-locator__empty-message cs-store-locator__empty-message--nolocation">\n                '+r.mage.__("Unfortunately we were not able to find this location.")+"</div>"),r(window).width()<breakpoint.laptop&&t.openMobileStores(),r(".cs-store-locator__empty-message--nolocation").show(),setTimeout((function(){r(".cs-store-locator__empty-message--nolocation").slideUp().remove(),r(window).width()<breakpoint.laptop&&t.closeMobileStores()}),5e3);t._$searchForm.removeClass("loading")}))},t.prototype.setUserPositionAndPopulateDistance=function(t,e){this.stores=this.populateStoresDistance(t,e),this.stores=this.stores.sort((function(t,e){return t.distance-e.distance})),this.stores=Object.freeze(this.stores),this._userPosition=e},t.prototype.renderItems=function(t,e){var o=this;(!this._allItemsRendered||r(window).width()<breakpoint.laptop)&&(this._$itemsList.empty(),t.map((function(t,s){(e||s<=o._options.limitOfShopsInitiallyDisplayed)&&o._$itemsList.append(o.getInfoWindowContent(t))})),t.length<=this._options.limitOfShopsInitiallyDisplayed?this._$itemsList.find(".cs-store-locator__stores-more-wrapper").remove():this._$itemsList.append('<div class="cs-store-locator__stores-more-wrapper"><span class="cs-store-locator__stores-more-text">'+r.mage.__("Show more stores")+"</span></div>"),this._$itemsList.find(".cs-store-locator__stores-more-wrapper").on("click",(function(t){o._$element.addClass("loading"),setTimeout((function(){o.renderItems(o.stores,!0)}),100),setTimeout((function(){o._$element.removeClass("loading"),o._$itemsList.find(".cs-store-locator__stores-more-wrapper").remove(),o._allItemsRendered=!0,o.mapChangeHandler()}),3e3)})),this._$element.find(".cs-store-locator__item").on("click",(function(t){r(t.target).hasClass("cs-store-locator__item-hours-trigger")||r(t.target).hasClass("cs-store-locator__item-hours-trigger-icon")||o.itemClickHandler(r(t.currentTarget))})),this._$itemsList.append('<div class="cs-store-locator__empty-message">\n        '+r.mage.__("Unfortunately we do not have any stores in your area. Please zoom the map to see bigger area.")+"</div>"))},t.prototype.getFilteredStores=function(){var t=this.map.getBounds(),e=this.stores.filter((function(e){return t.contains({lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)})}));return e=e.sort((function(t,e){return t.distance-e.distance}))},t.prototype.locationButtonClickHandler=function(){var t=this;this.getGeolocation().then((function(e){if(e){t.map.panTo(e);var o=r(window).width();o<breakpoint.laptop?t.map.setZoom(t._options.basicZoomMobile):o>=breakpoint.laptop&&o<breakpoint.laptopLg?t.map.setZoom(t._options.basicZoomSmallDesktop):t.map.setZoom(t._options.basicZoom),e!==t._userPosition&&(t._$itemsList.empty(),t._allItemsRendered=!1,t.setUserPositionAndPopulateDistance(t.stores,e),o<breakpoint.laptop?t.renderMobileStoresList():t.renderItems(t.getFilteredStores(),!1),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:e,map:t.map,icon:t._options.markerIcons.userLocation}))}}))},t.prototype.renderMobileStoresList=function(){var t=this;this.closeMobileStores();var e=this.getFilteredStores().slice(0,9);this.renderItems(this.getFilteredStores().slice(0,9),!1),setTimeout((function(){t.openMobileStores(),t._$itemsList.append('<div class="cs-store-locator__store-list-close"></div>'),t._$itemsList.find(".cs-store-locator__store-list-close").on("click",(function(e){t.closeMobileStores()}));var o=t._$element.find(".cs-store-locator__empty-message");e.length>0?o.hide():o.show()}),1e3)},t.prototype.markerClickHandler=function(t,e){this.updateActiveMarkerIcon(t),this._activeStoreId=e,r(window).width()<breakpoint.laptop&&(this.closeMobilePopup(),this.openMobilePopup(this._activeStoreId)),this.panToStore(e)},t.prototype.itemClickHandler=function(t){var e=t.attr("data-id");if(this.markers){var o=this.markers.find((function(t){return t.get("storeId")===e}));o&&this.updateActiveMarkerIcon(o)}this.panToStore(e),this._activeStoreId=e,r(window).width()<breakpoint.laptop&&(this.closeMobileStores(),this.openMobilePopup(e))},t.prototype.updateActiveMarkerIcon=function(t){this._activeMarker&&this._activeMarker.setIcon(this._options.markerIcons.pin),this._activeMarker=t,this._activeMarker.setIcon(this._options.markerIcons.pinActive)},t.prototype.panToStore=function(t){this._infoWindow.close(this.map,this._activeMarker);var e=this.stores.find((function(e){return e.sourceCode===t})),o={lat:e.latitude,lng:e.longitude},s=r(".cs-store-locator__sidebar").width();this.map.panTo(o),this.map.getZoom()<this._options.basicZoom&&this.map.setZoom(this._options.basicZoom),r(window).width()>=breakpoint.laptop&&!this._sidebarClosed&&this.map.panBy(-s/2,0),this._infoWindowOpened=!0,this._infoWindow.setContent(this.getInfoWindowContent(e)),this._infoWindow.open(this.map,this._activeMarker)},t.prototype.getInfoWindowContent=function(t){var e=t.postCode?t.postCode+" ":"",o=t.city?t.city:"",s=t.street?t.street:"",i=e||o||t.street?'<p class="cs-store-locator__item-address">\n        '+e+" "+o+", "+s+"</p>":"",n=t.phone?'<p class="cs-store-locator__item-phone">'+r.mage.__("Tel")+': <a href="tel:'+t.phone+'">'+t.phone+"</a></p>":"",a=t.fax?'<p class="cs-store-locator__item-fax">'+r.mage.__("Fax")+': <a href="fax:'+t.fax+'">'+t.fax+"</a></p>":"",p=t.email?'<p class="cs-store-locator__item-email">'+r.mage.__("E-Mail")+': <a href="mailto:'+t.email+'">'+t.email+"</a></p>":"",l=t.url?'<p class="cs-store-locator__item-website">'+r.mage.__("Website")+': <a href="//'+t.url+'" target="_blank" rel="nofollow">'+t.url+"</a></p>":"",c=t.distance?'<span class="cs-store-locator__item-distance">\n        '+r.mage.__("Distance")+": "+t.distance+" km</span>":"",h=t.description?'<p class="cs-store-locator__item-description">'+t.description+"</p>":"",d=t.routeLink,u=t.openingHours?t.openingHours:"";return'<div class="cs-store-locator__item"\n            data-id="'+t.sourceCode+'" data-lat="'+t.latitude+'" data-lng="'+t.longitude+'">\n            <div class="cs-store-locator__store-details-close"></div>\n            <div class="cs-store-locator__item-content">\n                <div class="cs-store-locator__item-header">\n                    <h2 class="cs-store-locator__item-name">'+t.name+'</h2>\n                    <a href="'+d+'" target="_blank" rel="noopener noreferrer" class="cs-store-locator__item-route">\n                        <span>'+r.mage.__("Route")+"</span>\n                    </a>\n                </div>\n                "+i+"\n                "+n+"\n                "+a+"\n                "+p+"\n                "+l+"\n                "+h+"\n            </div>\n            "+u+'\n            <div class="cs-store-locator__item-footer">\n                '+c+"\n            </div>\n        </div>"},t.prototype.getGeolocation=function(){return new Promise((function(t,e){"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(e){t({lat:e.coords.latitude,lng:e.coords.longitude})}),(function(t){e(new Error("Geolocation not enabled"))})):e(new Error("Geolocation not supported"))}))},t.prototype.toggleSidebar=function(){this._sidebarClosed?(r(".cs-store-locator__sidebar").removeClass("cs-store-locator__sidebar--closed"),r(".cs-store-locator__sidebar-toggler-icon").removeClass("cs-store-locator__sidebar-toggler-icon--closed")):(r(".cs-store-locator__sidebar").addClass("cs-store-locator__sidebar--closed"),r(".cs-store-locator__sidebar-toggler-icon").addClass("cs-store-locator__sidebar-toggler-icon--closed")),this._sidebarClosed=!this._sidebarClosed},t.prototype.filterItems=function(){var t=this.map.getBounds(),e=0;this._$element.find(".cs-store-locator__item").each((function(){t.contains({lat:parseFloat(r(this).attr("data-lat")),lng:parseFloat(r(this).attr("data-lng"))})?(r(this).show(),e++):r(this).hide()})),e>0?this._$element.find(".cs-store-locator__empty-message").hide():this._$element.find(".cs-store-locator__empty-message").show()},t.prototype.getCoordinatesFromQuery=function(t){return r.post({url:this._basePath+"graphql",data:JSON.stringify({query:'{\n                    addressLocation (\n                        query: "'+t+'"\n                    ) {\n                        latitude\n                        longitude\n                    }\n                  }'}),contentType:"application/json"})},t.prototype.populateStoresDistance=function(t,e){var o=this;return t.map((function(t){return s(s({},t),{distance:o.calculateDistance(t.latitude,t.longitude,e?e.lat:t.latitude,e?e.lng:t.longitude)})}))},t.prototype.openMobilePopup=function(t){var e=this.stores.find((function(e){return e.sourceCode===t}));r(".cs-store-locator__store-details").append(this.getInfoWindowContent(e)),this._$element.addClass("cs-store-locator--mobile-popup-open")},t.prototype.closeMobilePopup=function(){r(".cs-store-locator__store-details").html(""),this._$element.removeClass("cs-store-locator--mobile-popup-open"),this._$element.removeClass("cs-store-locator--mobile-stores-open")},t.prototype.openMobileStores=function(){this._$element.addClass("cs-store-locator--mobile-stores-open"),this._$element.removeClass("cs-store-locator--mobile-popup-open")},t.prototype.closeMobileStores=function(){this._$element.removeClass("cs-store-locator--mobile-stores-open")},t.prototype.windowResizeHandler=function(){r(window).width()>=breakpoint.laptop&&this.closeMobilePopup()},t.prototype.mapChangeHandler=function(){r(window).width()<breakpoint.laptop||(this._allItemsRendered||this.renderItems(this.getFilteredStores(),!1),this.filterItems())},t.prototype.zoomChangeHandler=function(){this.closeMobilePopup()},t.prototype.calculateDistance=function(t,e,o,s){var r=Math.abs(t-o)*Math.PI/180,i=Math.abs(e-s)*Math.PI/180,n=t*Math.PI/180,a=o*Math.PI/180,p=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(a)*Math.sin(i/2)*Math.sin(i/2),l=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p));return Number((6371*l).toFixed(2))},t.prototype.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE "),o=t.indexOf("Trident/");return e>0||o>0},t.prototype._initMap=function(){var t=this;this._setMarkerIcons(),this._createMarkers(),this.getGeolocation().then((function(e){t.setUserPositionAndPopulateDistance(t.stores,e),t._locationMarker&&t._locationMarker.setMap(null),t._locationMarker=new google.maps.Marker({position:e,map:t.map,icon:t._options.markerIcons.userLocation}),t.map.panTo(e),t.map.setZoom(t._options.basicZoom),t.renderItems(t.getFilteredStores(),!1),t._attachMapListeners(),t.mapChangeHandler()})).catch((function(e){t.setUserPositionAndPopulateDistance(t.stores,null),t.renderItems(t.stores,!1),t._attachMapListeners()}))},t.prototype._createMarkers=function(){var t=this;this.map&&(this.cluster&&this.cluster.clearMarkers(),this._infoWindow=new google.maps.InfoWindow({}),this.markers=this.stores.map((function(e){var o=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:t.map,icon:t._options.markerIcons.pin,optimized:!t.isIE()});return o.addListener("click",(function(){t.markerClickHandler(o,e.sourceCode)})),o.set("storeId",e.sourceCode),o})),this.cluster=new n.default(this.map,this.markers,{styles:[this._options.clusterStyles]}))},t.prototype._setMarkerIcons=function(){var t=this._$element.attr("data-image-path");this._options.markerIcons.pin.url=t+"/icon-pin.png",this._options.markerIcons.pinAlt.url=t+"/icon-pin-alt.png",this._options.markerIcons.pinActive.url=t+"/icon-pin-active.png",this._options.markerIcons.userLocation.url=t+"/icon-user-marker.png",this._options.clusterStyles.url=t+"/icon-cluster.png",this._options.markerIcons.pin.scaledSize=new google.maps.Size(this._options.markerIcons.pin.sizes.x,this._options.markerIcons.pin.sizes.y),this._options.markerIcons.pinAlt.scaledSize=new google.maps.Size(this._options.markerIcons.pinAlt.sizes.x,this._options.markerIcons.pinAlt.sizes.y),this._options.markerIcons.pinActive.scaledSize=new google.maps.Size(this._options.markerIcons.pinActive.sizes.x,this._options.markerIcons.pinActive.sizes.y),this._options.markerIcons.userLocation.scaledSize=new google.maps.Size(this._options.markerIcons.userLocation.sizes.x,this._options.markerIcons.userLocation.sizes.y)},t.prototype._attachMapListeners=function(){google.maps.event.addListener(this.map,"bounds_changed",this.mapChangeHandler.bind(this)),google.maps.event.addListener(this.map,"zoom_changed",this.zoomChangeHandler.bind(this))},t.prototype._attachEvents=function(){var t=this;this._$sidebarToggler.on("click",this.toggleSidebar.bind(this)),this._$locationButton.on("click",this.locationButtonClickHandler.bind(this)),this._$searchButton.on("click",this.searchButtonClickHandler.bind(this)),this._$searchForm.on("submit",(function(e){e.preventDefault();var o=r(".cs-store-locator__search-item.selected").length?r(".cs-store-locator__search-item.selected"):null;o&&t._$searchInput.val(o.text()),t.searchButtonClickHandler()})),this._$element.on("click",(function(e){var o=r(e.target),s=o.hasClass("cs-store-locator__item-hours-trigger"),i=o.hasClass("cs-store-locator__item-hours-trigger-icon");if(s||i){var n=s?o:o.parent(".cs-store-locator__item-hours-trigger");n.toggleClass("cs-store-locator__item-hours-trigger--open"),n.next().toggle()}r(e.target).hasClass("cs-store-locator__store-details-close")&&t.closeMobilePopup()})),window.addEventListener("resize",this.windowResizeHandler.bind(this)),window.addEventListener("orientationchange",(function(){setTimeout((function(){t.windowResizeHandler()}),200)}))},t}();e.default=a},244:function(t,e,o){"use strict";o.r(e),e.default=[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]},245:function(t,e,o){"use strict";
/**
 * @license
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function s(t,e,o){this.extend(s,google.maps.OverlayView),this.map_=t,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var r=o||{};this.gridSize_=r.gridSize||60,this.minClusterSize_=r.minimumClusterSize||2,this.maxZoom_=r.maxZoom||null,this.styles_=r.styles||[],this.imagePath_=r.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=r.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,null!=r.zoomOnClick&&(this.zoomOnClick_=r.zoomOnClick),this.averageCenter_=!1,null!=r.averageCenter&&(this.averageCenter_=r.averageCenter),this.setupStyles_(),this.setMap(t),this.prevZoom_=this.map_.getZoom();var i=this;google.maps.event.addListener(this.map_,"zoom_changed",(function(){var t=i.map_.getZoom(),e=i.map_.minZoom||0,o=Math.min(i.map_.maxZoom||100,21);t=Math.min(Math.max(t,e),o),i.prevZoom_!=t&&(i.prevZoom_=t,i.resetViewport())})),google.maps.event.addListener(this.map_,"idle",(function(){i.redraw()})),e&&(e.length||Object.keys(e).length)&&this.addMarkers(e,!1)}function r(t){this.markerClusterer_=t,this.map_=t.getMap(),this.gridSize_=t.getGridSize(),this.minClusterSize_=t.getMinClusterSize(),this.averageCenter_=t.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new i(this,t.getStyles(),t.getGridSize())}function i(t,e,o){t.getMarkerClusterer().extend(i,google.maps.OverlayView),this.styles_=e,this.padding_=o||0,this.cluster_=t,this.center_=null,this.map_=t.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}o.r(e),s.prototype.MARKER_CLUSTER_IMAGE_PATH_="../images/m",s.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",s.prototype.extend=function(t,e){return function(t){for(var e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},s.prototype.onAdd=function(){this.setReady_(!0)},s.prototype.draw=function(){},s.prototype.setupStyles_=function(){if(!this.styles_.length)for(var t,e=0;t=this.sizes[e];e++)this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t})},s.prototype.fitMapToMarkers=function(){for(var t,e=this.getMarkers(),o=new google.maps.LatLngBounds,s=0;t=e[s];s++)o.extend(t.getPosition());this.map_.fitBounds(o)},s.prototype.setStyles=function(t){this.styles_=t},s.prototype.getStyles=function(){return this.styles_},s.prototype.isZoomOnClick=function(){return this.zoomOnClick_},s.prototype.isAverageCenter=function(){return this.averageCenter_},s.prototype.getMarkers=function(){return this.markers_},s.prototype.getTotalMarkers=function(){return this.markers_.length},s.prototype.setMaxZoom=function(t){this.maxZoom_=t},s.prototype.getMaxZoom=function(){return this.maxZoom_},s.prototype.calculator_=function(t,e){for(var o=0,s=t.length,r=s;0!==r;)r=parseInt(r/10,10),o++;return{text:s,index:o=Math.min(o,e)}},s.prototype.setCalculator=function(t){this.calculator_=t},s.prototype.getCalculator=function(){return this.calculator_},s.prototype.addMarkers=function(t,e){if(t.length)for(var o=0;s=t[o];o++)this.pushMarkerTo_(s);else if(Object.keys(t).length)for(var s in t)this.pushMarkerTo_(t[s]);e||this.redraw()},s.prototype.pushMarkerTo_=function(t){if(t.isAdded=!1,t.draggable){var e=this;google.maps.event.addListener(t,"dragend",(function(){t.isAdded=!1,e.repaint()}))}this.markers_.push(t)},s.prototype.addMarker=function(t,e){this.pushMarkerTo_(t),e||this.redraw()},s.prototype.removeMarker_=function(t){var e=-1;if(this.markers_.indexOf)e=this.markers_.indexOf(t);else for(var o,s=0;o=this.markers_[s];s++)if(o==t){e=s;break}return-1!=e&&(t.setMap(null),this.markers_.splice(e,1),!0)},s.prototype.removeMarker=function(t,e){var o=this.removeMarker_(t);return!(e||!o)&&(this.resetViewport(),this.redraw(),!0)},s.prototype.removeMarkers=function(t,e){for(var o,s=t===this.getMarkers()?t.slice():t,r=!1,i=0;o=s[i];i++){var n=this.removeMarker_(o);r=r||n}if(!e&&r)return this.resetViewport(),this.redraw(),!0},s.prototype.setReady_=function(t){this.ready_||(this.ready_=t,this.createClusters_())},s.prototype.getTotalClusters=function(){return this.clusters_.length},s.prototype.getMap=function(){return this.map_},s.prototype.setMap=function(t){this.map_=t},s.prototype.getGridSize=function(){return this.gridSize_},s.prototype.setGridSize=function(t){this.gridSize_=t},s.prototype.getMinClusterSize=function(){return this.minClusterSize_},s.prototype.setMinClusterSize=function(t){this.minClusterSize_=t},s.prototype.getExtendedBounds=function(t){var e=this.getProjection(),o=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),r=e.fromLatLngToDivPixel(o);r.x+=this.gridSize_,r.y-=this.gridSize_;var i=e.fromLatLngToDivPixel(s);i.x-=this.gridSize_,i.y+=this.gridSize_;var n=e.fromDivPixelToLatLng(r),a=e.fromDivPixelToLatLng(i);return t.extend(n),t.extend(a),t},s.prototype.isMarkerInBounds_=function(t,e){return e.contains(t.getPosition())},s.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[]},s.prototype.resetViewport=function(t){for(var e,o=0;e=this.clusters_[o];o++)e.remove();var s;for(o=0;s=this.markers_[o];o++)s.isAdded=!1,t&&s.setMap(null);this.clusters_=[]},s.prototype.repaint=function(){var t=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),n.setTimeout((function(){for(var e,o=0;e=t[o];o++)e.remove()}),0)},s.prototype.redraw=function(){this.createClusters_()},s.prototype.distanceBetweenPoints_=function(t,e){if(!t||!e)return 0;var o=(e.lat()-t.lat())*Math.PI/180,s=(e.lng()-t.lng())*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},s.prototype.addToClosestCluster_=function(t){for(var e,o=4e4,s=null,i=(t.getPosition(),0);e=this.clusters_[i];i++){var n=e.getCenter();if(n){var a=this.distanceBetweenPoints_(n,t.getPosition());a<o&&(o=a,s=e)}}s&&s.isMarkerInClusterBounds(t)?s.addMarker(t):((e=new r(this)).addMarker(t),this.clusters_.push(e))},s.prototype.createClusters_=function(){if(this.ready_)for(var t,e=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),o=this.getExtendedBounds(e),s=0;t=this.markers_[s];s++)!t.isAdded&&this.isMarkerInBounds_(t,o)&&this.addToClosestCluster_(t)},r.prototype.isMarkerAlreadyAdded=function(t){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(t);for(var e,o=0;e=this.markers_[o];o++)if(e==t)return!0;return!1},r.prototype.addMarker=function(t){if(this.isMarkerAlreadyAdded(t))return!1;if(this.center_){if(this.averageCenter_){var e=this.markers_.length+1,o=(this.center_.lat()*(e-1)+t.getPosition().lat())/e,s=(this.center_.lng()*(e-1)+t.getPosition().lng())/e;this.center_=new google.maps.LatLng(o,s),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();t.isAdded=!0,this.markers_.push(t);var r=this.markers_.length;if(r<this.minClusterSize_&&t.getMap()!=this.map_&&t.setMap(this.map_),r==this.minClusterSize_)for(var i=0;i<r;i++)this.markers_[i].setMap(null);return r>=this.minClusterSize_&&t.setMap(null),this.updateIcon(),!0},r.prototype.getMarkerClusterer=function(){return this.markerClusterer_},r.prototype.getBounds=function(){for(var t,e=new google.maps.LatLngBounds(this.center_,this.center_),o=this.getMarkers(),s=0;t=o[s];s++)e.extend(t.getPosition());return e},r.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_},r.prototype.getSize=function(){return this.markers_.length},r.prototype.getMarkers=function(){return this.markers_},r.prototype.getCenter=function(){return this.center_},r.prototype.calculateBounds_=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)},r.prototype.isMarkerInClusterBounds=function(t){return this.bounds_.contains(t.getPosition())},r.prototype.getMap=function(){return this.map_},r.prototype.updateIcon=function(){var t=this.map_.getZoom(),e=this.markerClusterer_.getMaxZoom();if(e&&t>e)for(var o,s=0;o=this.markers_[s];s++)o.setMap(this.map_);else if(this.markers_.length<this.minClusterSize_)this.clusterIcon_.hide();else{var r=this.markerClusterer_.getStyles().length,i=this.markerClusterer_.getCalculator()(this.markers_,r);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(i),this.clusterIcon_.show()}},i.prototype.triggerClusterClick=function(){var t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t.map_,"clusterclick",this.cluster_),t.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds())},i.prototype.onAdd=function(){if(this.div_=document.createElement("DIV"),this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(t),this.div_.innerHTML=this.sums_.text}this.getPanes().overlayMouseTarget.appendChild(this.div_);var e=this;google.maps.event.addDomListener(this.div_,"click",(function(){e.triggerClusterClick()}))},i.prototype.getPosFromLatLng_=function(t){var e=this.getProjection().fromLatLngToDivPixel(t);return e.x-=parseInt(this.width_/2,10),e.y-=parseInt(this.height_/2,10),e},i.prototype.draw=function(){if(this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px",this.div_.style.zIndex=google.maps.Marker.MAX_ZINDEX+1}},i.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},i.prototype.show=function(){if(this.div_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(t),this.div_.style.display=""}this.visible_=!0},i.prototype.remove=function(){this.setMap(null)},i.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)},i.prototype.setSums=function(t){this.sums_=t,this.text_=t.text,this.index_=t.index,this.div_&&(this.div_.innerHTML=t.text),this.useStyle()},i.prototype.useStyle=function(){var t=Math.max(0,this.sums_.index-1);t=Math.min(this.styles_.length-1,t);var e=this.styles_[t];this.url_=e.url,this.height_=e.height,this.width_=e.width,this.textColor_=e.textColor,this.anchor_=e.anchor,this.textSize_=e.textSize,this.backgroundPosition_=e.backgroundPosition},i.prototype.setCenter=function(t){this.center_=t},i.prototype.createCss=function(t){var e=[];e.push("background-image:url("+this.url_+");");var o=this.backgroundPosition_?this.backgroundPosition_:"0 0";e.push("background-position:"+o+";"),"object"==typeof this.anchor_?("number"==typeof this.anchor_[0]&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?e.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"==typeof this.anchor_[1]&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?e.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):e.push("width:"+this.width_+"px; text-align:center;")):e.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var s=this.textColor_?this.textColor_:"black",r=this.textSize_?this.textSize_:11;return e.push("cursor:pointer; top:"+t.y+"px; left:"+t.x+"px; color:"+s+"; position:absolute; font-size:"+r+"px; font-family:Arial,sans-serif; font-weight:bold"),e.join("")};var n=n||{};n.MarkerClusterer=s,s.prototype.addMarker=s.prototype.addMarker,s.prototype.addMarkers=s.prototype.addMarkers,s.prototype.clearMarkers=s.prototype.clearMarkers,s.prototype.fitMapToMarkers=s.prototype.fitMapToMarkers,s.prototype.getCalculator=s.prototype.getCalculator,s.prototype.getGridSize=s.prototype.getGridSize,s.prototype.getExtendedBounds=s.prototype.getExtendedBounds,s.prototype.getMap=s.prototype.getMap,s.prototype.getMarkers=s.prototype.getMarkers,s.prototype.getMaxZoom=s.prototype.getMaxZoom,s.prototype.getStyles=s.prototype.getStyles,s.prototype.getTotalClusters=s.prototype.getTotalClusters,s.prototype.getTotalMarkers=s.prototype.getTotalMarkers,s.prototype.redraw=s.prototype.redraw,s.prototype.removeMarker=s.prototype.removeMarker,s.prototype.removeMarkers=s.prototype.removeMarkers,s.prototype.resetViewport=s.prototype.resetViewport,s.prototype.repaint=s.prototype.repaint,s.prototype.setCalculator=s.prototype.setCalculator,s.prototype.setGridSize=s.prototype.setGridSize,s.prototype.setMaxZoom=s.prototype.setMaxZoom,s.prototype.onAdd=s.prototype.onAdd,s.prototype.draw=s.prototype.draw,r.prototype.getCenter=r.prototype.getCenter,r.prototype.getSize=r.prototype.getSize,r.prototype.getMarkers=r.prototype.getMarkers,i.prototype.onAdd=i.prototype.onAdd,i.prototype.draw=i.prototype.draw,i.prototype.onRemove=i.prototype.onRemove,Object.keys=Object.keys||function(t){var e=[];for(var o in t)t.hasOwnProperty(o)&&e.push(o);return e},e.default=s},3:function(t,o){t.exports=e}})}));